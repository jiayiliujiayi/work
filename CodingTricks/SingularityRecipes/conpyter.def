# definition file for jupyter notebook under singularity 3.8.3

## Tell the Singularity bootstrap agent to pull the image 
## jupyter/scipy-notebook stack from the Docker container library. 
## Other available images: 
## https://jupyter-docker-stacks.readthedocs.io/en/latest/using/selecting.html
BootStrap: docker
	From: jupyter/tensorflow-notebook

%labels
    Version v0.0.1

%help
    Please contact Jiayi Liu for help: jl2791@scarletmail.rutgers.edu

# installation
## basic stuffs
    apt-get update
    apt-get install -y --no-install-recommends \
    bash-completion \
    ca-certificates \
    locales
    echo 'en_US.UTF-8 UTF-8' >> /etc/locale.gen && \
    /usr/sbin/locale-gen en_US.UTF-8 && \
    /usr/sbin/update-locale LANG=en_US.UTF-8

## misc stuffs
    apt-get update && apt-get install -y --no-install-recommends \
    file \
    less \
    openssl \
    libssl-dev \
    curl \
    libcurl4-openssl-dev \

## devel tools
    apt-get update && apt-get install -y --no-install-recommends \
    g++ \
    gfortran \
    make \
    cmake \
    autoconf 

# Languages
    apt-get install -y --no-install-recommends \
    perl \
    tcl8.6-dev \
    tk8.6-dev 

# Compression
    apt-get install -y --no-install-recommends \
    zlib1g-dev \
    libbz2-dev \
    liblzma-dev \
    libxml2-dev \
    libglpk-dev \
    unzip \
    zip

# Math
    apt-get install -y --no-install-recommends \
    libblas-dev \
    libatlas3-base 

# Plotting stuff
    apt-get install -y --no-install-recommends \
    libpng-dev \
    libtiff5-dev \
    libjpeg-dev 

# Ghostscript, for making PDFs.
    apt-get install -y --no-install-recommends \
    texinfo \
    texlive-extra-utils \
    texlive-fonts-recommended \
    texlive-fonts-extra \
    texlive-latex-recommended \
    ghostscript libgs-dev \
    gsfonts \
    fonts-texgyre

# Miscellaneous libraries
    apt-get install -y --no-install-recommends \
    libreadline-dev \
    libpcre3-dev \
    libgsl-dev \
    libssl-dev \
    libcurl4-openssl-dev

# jags for infercnv
    apt-get install -y --no-install-recommends \
    jags \
    libxml2-dev

## jags for infercnv
    apt-get install -y --no-install-recommends \
    jags \
    libxml2-dev

# conda
## dependencies
apt-get install -y --no-install-recommends \
    libgl1-mesa-glx \
    libegl1-mesa \
    libxrandr2 libxrandr2 libxss1 \
    libxcursor1 libxcomposite1 \
    libasound2 libxi6 libxtst6

## conda per se
wget --quiet --no-check-certificate https://repo.anaconda.com/archive/https://repo.anaconda.com/archive/Anaconda3-5.3.1-Linux-x86_64.sh -O ~/anaconda.sh && \
    /bin/bash ~/anaconda.sh -b -p /opt/conda && \
    rm ~/anaconda.sh && \
    ln -s /opt/conda/etc/profile.d/conda.sh /etc/profile.d/conda.sh && \
    echo ". /opt/conda/etc/profile.d/conda.sh" >> ~/.bashrc && \
    echo "conda activate base" >> ~/.bashrc && \
    find /opt/conda/ -follow -type f -name '*.a' -delete && \
    find /opt/conda/ -follow -type f -name '*.js.map' -delete && \
    /opt/conda/bin/conda clean -afy
export $PATH=/opt/conda/bin:$PATH

## set up bioconda
conda config --add channels defaults
conda config --add channels bioconda
conda config --add channels conda-forge

## install bwa environment
conda install bwa

# jupyter lab
conda install -c conda-forge jupyterlab